<div class="container">
  <div class="header">
    <h1>Sales</h1>
  </div>

  <!-- Today's Sale Summary -->
  <div class="summary-container">
    <h2>Today's Sale Summary</h2>
    <div class="summary-details">
      <p><strong>Total Sales:</strong> {{ todaysSaleSummary.total_count }}</p>
      <p><strong>Total Revenue:</strong> {{ todaysSaleSummary.total_revenue | currency:'INR' }}</p>
      <p><strong>Total Items Sold:</strong> {{ todaysSaleSummary.total_items_sold }}</p>
    </div>
  </div>

  <div class="row g-3 mb-3">
    <div class="col-md-3">
      <label for="categoryFilter" class="form-label">Category</label>
      <select id="categoryFilter" class="form-select" [(ngModel)]="selectedCategoryId" (change)="onFilterChange()">
        <option value="">All Categories</option>
        <option *ngFor="let category of categories" [value]="category.id">{{ category.name }}</option>
      </select>
    </div>
    <div class="col-md-3">
      <label for="productFilter" class="form-label">Product Name</label>
      <input type="text" id="productFilter" class="form-control" [(ngModel)]="productNameFilter" (input)="onFilterChange()" placeholder="Search by product name">
    </div>
    <div class="col-md-3">
      <label for="customerFilter" class="form-label">Customer Name</label>
      <input type="text" id="customerFilter" class="form-control" (keyup)="applyFilter($event)" placeholder="Search by customer name">
    </div>
    <div class="col-md-3">
      <label for="dateFilter" class="form-label">Date Filter</label>
      <select id="dateFilter" class="form-select" [(ngModel)]="selectedDateFilter" (change)="onFilterChange()">
        <option value="all">All Time</option>
        <option value="today">Today</option>
        <option value="yesterday">Yesterday</option>
        <option value="this_week">This Week</option>
        <option value="this_month">This Month</option>
        <option value="custom">Custom Range</option>
      </select>
    </div>
    <div *ngIf="selectedDateFilter === 'custom'" class="col-md-6 d-flex align-items-end">
      <div class="me-2">
        <label for="startDate" class="form-label">Start Date</label>
        <input type="date" id="startDate" class="form-control" [(ngModel)]="customStartDate" (change)="onFilterChange()">
      </div>
      <div>
        <label for="endDate" class="form-label">End Date</label>
        <input type="date" id="endDate" class="form-control" [(ngModel)]="customEndDate" (change)="onFilterChange()">
      </div>
    </div>
    <div class="col-12 d-flex justify-content-end">
      <button class="btn btn-primary me-2" (click)="openCreateSaleDialog()" [disabled]="!(isDayStarted$ | async)">Create New Sale</button>
      <button class="btn btn-success" (click)="exportExcel()">Export to Excel</button>
    </div>
  </div>

<div class="table-responsive">
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th>ID</th>
        <th>Customer</th>
        <th>Total Quantity</th>
        <th>Total Price</th>
        <th>Date</th>
        <th>View Details</th>
        <th>Print Receipt</th>
        <th>Send via WhatsApp</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let element of sales | paginate: { itemsPerPage: 10, currentPage: p }">
        <td>{{element.id}}</td>
        <td>{{element.customerName}}</td>
        <td>{{element.totalQuantity}}</td>
        <td>{{element.totalPrice | currency:'INR'}}</td>
        <td>{{element.date | date:'shortDate'}}</td>
        <td>
          <button class="btn btn-info btn-sm" (click)="viewDetails(element)">View</button>
        </td>
        <td>
          <button class="btn btn-warning btn-sm" (click)="printReceipt(element)">Print</button>
        </td>
        <td>
          <button class="btn btn-success btn-sm" (click)="sendReceiptViaWhatsApp(element)">WhatsApp</button>
        </td>
      </tr>
    </tbody>
  </table>
  <pagination-controls (pageChange)="p = $event"></pagination-controls>
</div>
